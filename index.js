const name="Database";let main=null;try{main=window??self}catch(e){main=global}async function Exporter(e,...t){var n=(await import("node:module"))["createRequire"],n=n("file:///"+(await import("path")).resolve(".").replaceAll("\\","/")),r={exports:{}};return e(r,r.exports,n),r.exports[t[0]](...t.slice(1))}Object.defineProperty(main,name,{writable:!1,configurable:!1,enumerable:!1,value:function(...e){return Exporter(function(e,t,n){"use strict";function r(e,t,n,r){if(t&&"object"==typeof t||"function"==typeof t)for(var a,o=f(t),i=0,u=o.length;i<u;i++)a=o[i],s.call(e,a)||a===n||c(e,a,{get:(function(e){return t[e]}).bind(null,a),enumerable:!(r=l(t,a))||r.enumerable});return e}function a(e,t,n){return n=null!=e?i(u(e)):{},r(!t&&e&&e.__esModule?n:c(n,"default",{value:e,enumerable:!0}),e)}var o,i=Object.create,c=Object.defineProperty,l=Object.getOwnPropertyDescriptor,f=Object.getOwnPropertyNames,u=Object.getPrototypeOf,s=Object.prototype.hasOwnProperty,d={},v=d,p={ForceHistoryCleanUp:function(){return b},ForceHistoryCleanUpForEach:function(){return O},Get:function(){return B},Latest:function(){return y},Set:function(){return S}};for(o in p)c(v,o,{get:p[o],enumerable:!0});e.exports=(e=d,r(c({},"__esModule",{value:!0}),e));function m(e){e=e.replace(/(\/)$/,"");var t=[];return h.default.readdirSync(e).forEach(function(e){t.push(e)}),t}function D(e){try{return h.default.readFileSync(e,"utf8")}catch(e){}}var g=a(n("fs"),1),h=a(n("fs"),1),w=a(n("process"),1),y=function(){var t,n,r,a,o,i,u,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"*",c=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},l=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null,f=3<arguments.length&&void 0!==arguments[3]?arguments[3]:"id";if(w.default.env&&w.default.env.DB)return"*"==e?(t={},m(w.default.env.DB).map(function(e){t[e]=y(e,c,l,f)}),t):Array.isArray(e)?(n={},e.map(function(e){n[e]=y(e,c,l,f)}),n):(u=[],r=[],B(e).map(function(e){var t=e.data[f],n=r.indexOf(t);-1==n?(r.push(t),u.push(e)):u[n].timestamp<e.timestamp&&(u[n]=e)}),a=Object.keys(c),o=Object.values(c),i=null==l?0:Date.parse(new Date(timestamp-864e5*l).toISOString()),u=u.filter(function(e){return+e.timestamp>=i}).filter(function(e){for(var t=0;t<a.length;t++){var n=a[t],r=o[t];if(void 0===e.data[n]||e.data[n]!=r)return!1}return!0}));throw new Error("process.env.DB is not defined")},O=function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"id";if(!w.default.env||!w.default.env.DB)throw new Error("process.env.DB is not defined");m(w.default.env.DB).map(function(e){return b(e,t)})},b=function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"id";if(!w.default.env||!w.default.env.DB)throw new Error("process.env.DB is not defined");var e=y(t,{},null,e),n="".concat(w.default.env.DB,"/").concat(t);if(!process.env||!process.env.DB)throw new Error("process.env.DB is not defined");g.default.rmSync(n,{recursive:!0,force:!0}),e.map(function(e){return S(t,e.data,e.timestamp)})},S=function(t,e){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(!w.default.env||!w.default.env.DB)throw new Error("process.env.DB is not defined");var r,a=null==n?Date.parse((new Date).toISOString()):Date.parse(new Date(parseInt(n)).toISOString());r=(r="".concat(w.default.env.DB,"/").concat(t,"/").concat(a,"/")).toString(),g.default.existsSync(r)||g.default.mkdirSync(r,{recursive:!0});for(var o,i,u=Object.keys(e).map(function(e){return"".concat(w.default.env.DB,"/").concat(t,"/").concat(a,"/")+e}),c=Object.values(e),l=0;l<u.length;l++)o=u[l],i=JSON.stringify(c[l]),g.default.writeFileSync(o,i.toString())},B=function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(!w.default.env||!w.default.env.DB)throw new Error("process.env.DB is not defined");var r=Date.parse((new Date).toISOString()),a=null==n?0:Date.parse(new Date(r-864e5*n).toISOString()),o=null;try{o=m("".concat(w.default.env.DB,"/").concat(t,"/")).filter(function(e){return a<=+e}).map(function(e){return"".concat(w.default.env.DB,"/").concat(t,"/")+e+"/"})}catch(e){return[]}var r=Object.keys(e),i=Object.values(e);return r.map(function(t,n){o=o.filter(function(e){return m(e).includes(t)}).filter(function(e){return JSON.parse(D(e+t))==i[n]})}),o.map(function(t){var e=t.split("/"),e=e[e.length-2],n=new Date(parseInt(e)).toGMTString(),r={};m(t).map(function(e){r[e]=JSON.parse(D(t+e))});return{timestamp:e,time:n,data:r}}).reverse()}},...e)}});